<VirtualHost *:80>
    DocumentRoot /var/www/html/public
    KeepAlive Off
    RewriteEngine On

    SetEnvIf Request_URI ".gif$" no_log
    SetEnvIf Request_URI ".jpg$" no_log
    SetEnvIf Request_URI ".png$" no_log
    SetEnvIf Request_URI ".js$"  no_log
    SetEnvIf Request_URI ".css$" no_log
    SetEnvIf Request_URI ".ico$" no_log
    SetEnvIf Request_URI ".woff$" no_log

    # Log
    # https://gist.github.com/vmadman/5472166
    LogFormat "{ \
\"@timestamp\":\"%{%FT%T%z}t\", \
\"client_ip\":\"%a\", \
\"client_port\":\"%{remote}p\", \
\"server_ip\":\"%A\", \
\"X-Forwarded-For\":\"%{X-Forwarded-For}i\", \
\"user\":\"%u\", \
\"REMOTE_USER\":\"%{REMOTE_USER}i\", \
\"JSESSIONID\":\"%{JSESSIONID}C\", \
\"pid\":\"%p\", \
\"protocol\":\"%H\", \
\"http_method\":\"%m\", \
\"vhost\":\"%{Host}i\", \
\"service_port\":\"%p\", \
\"path\":\"%U\", \
\"query_string\":\"%q\", \
\"referer\":\"%{Referer}i\", \
\"user_agent\":\"%{User-agent}i\", \
\"response_code\":\"%>s\", \
\"response_location\":\"%{Location}o\", \
\"Content-Type\":\"%{Content-Type}o\", \
\"bytes_in\":\"%I\", \
\"bytes_out\":\"%O\", \
\"keepalive\":\"%X\", \
\"duration_micros\":\"%D\" \
}" logstash_json
    CustomLog /var/www/html/logs/access_log.jsonl logstash_json
    # https://stackoverflow.com/questions/39592834/how-to-make-apache-output-its-logs-in-json-instead-of-its-default-logging-format
    ErrorLogFormat "{ \
\"time\":\"%{%Y-%m-%d}tT%{%T}t.%{msec_frac}tZ\", \
\"function\" : \"[%-m:%l]\" , \
\"process\" : \"[pid %P:tid %T]\" , \
\"message\" : \"%M\" ,\
\"referer\"\ : \"%{Referer}i\" \
}," err_logstash_json
    ErrorLog /var/www/html/logs/error_log.jsonl err_logstash_json

    <Directory /var/www/html/public>
        AllowOverride all
        Satisfy Any

        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ index.php [QSA,L]
    </Directory>

</VirtualHost>
